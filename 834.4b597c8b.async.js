(self.webpackChunkcarefree_antd_root=self.webpackChunkcarefree_antd_root||[]).push([[834,729],{28209:function(Oe,G,f){"use strict";f.r(G),f.d(G,{default:function(){return Ee}});var re=f(5574),S=f.n(re),h=f(67294),i=f(23777),J=f(34077),ne=f(12444),se=f.n(ne),ie=f(72004),oe=f.n(ie),W=f(56217),j=f(72278),ue=["search","table"],Q=function(){function d(t){var e=this;se()(this,d),this.store={search:{},loading:!1,table:{page:1,pageSize:20,total:0,dataSource:[],selectRows:[],selectRowKeys:[]}},this.initialValues={search:{},loading:!1,table:{page:1,pageSize:20,total:0,dataSource:[],selectRows:[],selectRowKeys:[]}},this.components={},this.getStringToArr=function(a){return a.split("_")},this.getInitValue=function(a){return(0,j.d9)((0,j.U2)(e.initialValues,e.getStringToArr(a)),!1)},this.getValue=function(a){return(0,j.U2)(e.store,e.getStringToArr(a))},this.setValue=function(a,r){return e.store=(0,j.t8)(e.store,e.getStringToArr(a),r),e.store},this.setBatchValue=function(a){return Object.entries(a).forEach(function(r){var s=S()(r,2),l=s[0],p=s[1];e.store=(0,j.t8)(e.store,e.getStringToArr(l),p)}),e.store},this.getStore=function(){return e.store},this.registerId=function(a,r){e.components[a]=r},this.unregister=function(a,r){delete e.components[a],a==="search"?e.setValue(a,r||e.initialValues.search||{}):a==="table"?e.setValue(a,r||e.initialValues.table||{page:1,pageSize:20,total:0,dataSource:[],selectRows:[],selectRowKeys:[]}):e.setValue(a,r||e.initialValues[a])},this.tableLoading=function(a){e.setValue("loading",a),e.updateComponent(["table"])},this.updateComponent=function(a){a.forEach(function(r){e.components[r]()})};var o=t||{},n=o.search,v=o.table,b=(0,W.Z)(o,ue);n&&this.setValue("search",(0,i.Z)({},n)),v&&this.setValue("table",(0,i.Z)({},v)),Object.entries((0,i.Z)({},b)).forEach(function(a){var r=S()(a,2),s=r[0],l=r[1];e.setValue(s,l)}),this.initialValues=(0,j.d9)(t||{},!1)}return oe()(d,[{key:"stores",get:function(){return this.store}}]),d}(),X=function(t){var e=t.main,o=t.initialValues,n=h.useRef();return e?n.current=e:n.current=new Q(o),[n.current]},Y=h.createContext(new Q),k=function(){return h.useContext(Y)},q=h.createContext({}),U=function(){return h.useContext(q)},le=f(15009),H=f.n(le),_=f(82862),ce=f(38018),fe=f(11238),de=["requestType","headers","data","module"],ge=function(){var d=(0,_.Z)(H()().mark(function t(e,o){var n,v,b,a,r,s,l,p,g,m;return H()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return n=o.requestType,v=o.headers,b=o.data,a=o.module,r=(0,W.Z)(o,de),s=(0,i.Z)({},v||{}),l=b,n==="json"?(s=(0,i.Z)({Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},s),typeof l!="string"&&(l=JSON.stringify(l))):n==="form"?(s=(0,i.Z)({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},s),l=typeof l=="string"?l:ce.stringify(l)):s=(0,i.Z)({Accept:"application/json"},s),p=e,a&&(g=/^\//.test(e),p="/"+a+(g?"":"/")+e),c.prev=6,c.next=9,(0,fe.ZP)(p,(0,i.Z)({requestType:n,headers:(0,i.Z)({},s),data:l},r,{getResponse:!0}));case 9:return m=c.sent,console.log("\u6DFB\u52A0getResponse\u8FD4\u56DE\u6570\u636E\u683C\u5F0F\u6570\u636E,\u53EF\u4F7F\u7528window.RequestResponse\u83B7\u53D6\u8FD4\u56DEresponse--->",m),window.RequestResponse=m.response,c.abrupt("return",m.data);case 15:throw c.prev=15,c.t0=c.catch(6),c.t0;case 18:case"end":return c.stop()}},t,null,[[6,15]])}));return function(e,o){return d.apply(this,arguments)}}(),y=ge,he=function(t,e){return y(t,(0,i.Z)({},e||{},{method:"POST"}))},ve=function(t,e){return y(t,(0,i.Z)({},e||{},{method:"GET"}))},pe=function(t,e){return y(t,(0,i.Z)({},e||{},{method:"DELETE"}))},me=function(t,e){return y(t,(0,i.Z)({},e||{},{method:"PUT"}))},be=function(t,e){return y(t,(0,i.Z)({},e||{},{method:"PATCH"}))},Ce=function(t,e){return y(t,(0,i.Z)({},e||{},{method:"HEAD"}))},Se=function(t,e){return y(t,(0,i.Z)({},e||{},{method:"OPTIONS"}))},Te={POST:he,GET:ve,DELETE:pe,PUT:me,PATCH:be,HEAD:Ce,OPTIONS:Se},ee=function(){var d=(0,_.Z)(H()().mark(function t(e){var o,n,v,b,a,r,s,l,p,g,m,P,c,Z,D,C;return H()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(o=e.Api,n=e.main,v=e.tableConfig,b=e.apiName,a=n.setBatchValue,r=n.getValue,s=n.tableLoading,l=v||{},p=l.table,g=o[b||"table"]||{},g.url){u.next=6;break}return u.abrupt("return");case 6:if(u.prev=6,s(!0),a({table_page:(p||{}).page||1,table_pageSize:(p||{}).page||20}),m=!0,g.before&&(m=g.before(n)),m){u.next=14;break}return s(!1),u.abrupt("return");case 14:return P=(0,i.Z)({page:r("table_page"),pageSize:r("table_pageSize")},r("search")),g.requestBefore&&(P=g.requestBefore(n)),u.next=18,Te[g.method||"GET"](""+g.url,(0,i.Z)({},g.options||{},{module:g.module,data:P})).catch(function(M){s(!1)});case 18:c=u.sent,g.requestAfter?g.requestAfter({response:c,main:n}):c&&c.code===200&&(Z=c.data||{},D=Z.rows,C=Z.total,a({table_dataSource:D||[],table_total:C||0})),s(!1),u.next=26;break;case 23:u.prev=23,u.t0=u.catch(6),s(!1);case 26:case"end":return u.stop()}},t,null,[[6,23]])}));return function(e){return d.apply(this,arguments)}}(),te=f(4393),T=f(85893),Pe=function(){var t=U(),e=t.search,o=t.tableConfig,n=t.searchCardProps,v=t.searchHead,b=U(),a=b.Api,r=a===void 0?{}:a,s=k(),l=s.setValue,p=s.registerId,g=s.unregister,m=s.getInitValue,P=h.useState(""),c=S()(P,2),Z=c[0],D=c[1],C=e||{},A=C.isSearch,u=C.initialValues,M=C.form,B=C.apiName,K=J.default.useForm(M),L=S()(K,1),E=L[0],O=function(){D(new Date().getTime().toString())},x=function(V,F){l("search",F)};h.useEffect(function(){u&&l("search",u||{})},[]),p("search",O),h.useEffect(function(){return function(){return g("search",u)}},[]),h.useEffect(function(){u&&(Object.entries(u).forEach(function(R){var V=S()(R,2),F=V[0],$=V[1];l("search_"+F,$)}),O())},[]);var w=h.useMemo(function(){return"bordered"in(n||{})?n.bordered:!!v},[!!v,(n||{}).bordered]);return(0,T.jsx)(te.Z,(0,i.Z)({title:v&&v(s)},n||{},{style:(0,i.Z)({marginBottom:10},(n||{}).style||{}),bodyStyle:(0,i.Z)({padding:w?12:0},(n||{}).bodyStyle||{}),bordered:w,children:(0,T.jsx)(J.default,(0,i.Z)({form:E,initialValues:u||m("search")||{}},A?{onFinish:function(V){e&&e.onFinish?e.onFinish(V,s):ee({main:s,tableConfig:o,Api:r,apiName:B})},onRest:function(){e&&e.onRest?e.onRest():(l("search",u||{}),E.resetFields())}}:{},e,{onValuesChange:x}))}))},Ae=Pe,Ve=f(95639),ye=function(){var t=U(),e=t.tableConfig,o=t.columns,n=t.tableCardProps,v=t.Api,b=v===void 0?{}:v,a=t.tableHead,r=k(),s=r.getValue,l=r.setValue,p=r.setBatchValue,g=r.updateComponent,m=r.registerId,P=r.unregister,c=h.useState(""),Z=S()(c,2),D=Z[0],C=Z[1],A=s("table"),u=A.page,M=A.pageSize,B=A.total,K=A.dataSource,L=A.selectRowKeys,E=e||{},O=E.pagination,x=E.rowSelection,w=E.table,R=E.apiName,V=function(){C(new Date().getTime().toString())},F=function(I,N){p({table_page:I,table_pageSize:N}),e&&e.pagination&&e.pagination.onChange?e.pagination.onChange(I,N,r):ee({main:r,tableConfig:e,Api:b,apiName:R})},$=h.useMemo(function(){return!!(e&&"pagination"in e&&O===!1)},[JSON.stringify(O)]);m("table",V),h.useEffect(function(){return function(){return P("table",w)}},[]),h.useEffect(function(){w&&(Object.entries(w).forEach(function(z){var I=S()(z,2),N=I[0],je=I[1];l("table_"+N,je)}),V())},[]);var Re=h.useMemo(function(){return typeof o=="function"?o(r):o||[]},[o]),Ie=h.useMemo(function(){return"bordered"in(n||{})?n.bordered:!!a},[!!a,(n||{}).bordered]);return(0,T.jsx)(te.Z,(0,i.Z)({},n||{},{title:a&&a(r),bodyStyle:(0,i.Z)({padding:0},(n||{}).bodyStyle||{}),bordered:Ie,children:(0,T.jsx)(Ve.Z,(0,i.Z)({rowKey:"id",size:"small",bordered:!0,loading:s("loading")},e,x?{rowSelection:(0,i.Z)({},x,{selectedRowKeys:L,onChange:function(I,N){p({"table.selectRowKeys":I,"table.selectRows":N}),g(["table"])}})}:{},{dataSource:K,columns:Re,pagination:!$&&(0,i.Z)({},O||{},{pageSize:M,total:B,current:u,onChange:F})}))}))},Ze=ye,ae=function(t){var e=X({main:t.main,initialValues:t.initialValues}),o=S()(e,1),n=o[0];return(0,T.jsx)(Y.Provider,{value:n,children:(0,T.jsxs)(q.Provider,{value:t,children:[(0,T.jsx)(Ae,{}),(0,T.jsx)(Ze,{})]})})};ae.useMain=X;var Ee=ae},24654:function(){}}]);
